# Simple Flask ML App - Iris Classification

A simple Flask application that loads a pre-trained machine learning model and performs iris flower classification predictions. Testing deploy Flask apps with GitHub Actions and Azure.

## Features

- **Iris Flower Classification**: Predicts iris species based on flower measurements
- **RESTful API**: Simple JSON endpoints for predictions
- **Health Check**: Built-in health check endpoint for deployment monitoring
- **Pre-trained Model**: Uses a trained Random Forest classifier

## Project Structure

```
├── app.py                 # Main Flask application
├── train_model.py         # Script to train and save the model
├── requirements.txt       # Python dependencies
├── data/
│   └── iris.csv          # Dataset (generated by train_model.py)
└── model/
    └── model.pkl         # Trained model (generated by train_model.py)
```

## Setup Instructions

### 1. Install Dependencies

```bash
pip install -r requirements.txt
```

### 2. Train the Model

```bash
python train_model.py
```

This will:
- Create `data/iris.csv` with the iris dataset
- Train a Random Forest model
- Save the model to `model/model.pkl`

### 3. Run the App

```bash
python app.py
```

The app will be available at `http://localhost:5000`

## API Endpoints

### `GET /`
Home endpoint with API information

```bash
curl http://localhost:5000/
```

### `GET /info`
Get dataset and model information

```bash
curl http://localhost:5000/info
```

### `GET /health`
Health check endpoint (useful for Azure App Service monitoring)

```bash
curl http://localhost:5000/health
```

### `POST /predict`
Make predictions

```bash
curl -X POST http://localhost:5000/predict \
  -H "Content-Type: application/json" \
  -d '{
    "sepal_length": 5.1,
    "sepal_width": 3.5,
    "petal_length": 1.4,
    "petal_width": 0.2
  }'
```

**Response:**
```json
{
  "input": {
    "sepal_length": 5.1,
    "sepal_width": 3.5,
    "petal_length": 1.4,
    "petal_width": 0.2
  },
  "prediction": "setosa",
  "probabilities": {
    "setosa": 0.98,
    "versicolor": 0.02,
    "virginica": 0.0
  }
}
```

## Deployment to Azure

### Prerequisites
- Azure subscription
- Azure App Service created
- GitHub repository

### Steps

1. **Create Azure App Service** with Python 3.11 runtime
2. **Set up GitHub Actions** workflow to:
   - Install dependencies from `requirements.txt`
   - Run `train_model.py` to generate model and data
   - Deploy to Azure App Service
3. **Configure startup command** in Azure:
   ```
   gunicorn --bind 0.0.0.0 --workers 1 app:app
   ```

### Example GitHub Actions Workflow

See `.github/workflows/azure-deploy.yml` for the deployment workflow configuration.

## Testing Example Data

Iris dataset measurements (in cm):
- **Setosa**: sepal_length: 5.1, sepal_width: 3.5, petal_length: 1.4, petal_width: 0.2
- **Versicolor**: sepal_length: 7.0, sepal_width: 3.2, petal_length: 4.7, petal_width: 1.4
- **Virginica**: sepal_length: 6.3, sepal_width: 3.3, petal_length: 6.0, petal_width: 2.5
